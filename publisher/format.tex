\catcode`\@=11
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Textblock Size and Position on the Page
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newdimen\textblock@odd@left
\newdimen\textblock@even@left

\def\setspinemargin#1{
  \textblock@odd@left=#1
  \textblock@even@left=\pdfpagewidth
    \advance\textblock@even@left by -\hsize
    \advance\textblock@even@left by -#1
}

\pdfhorigin=0pt
\pdfvorigin=0pt
\pdfpagewidth=5 true in
\pdfpageheight=8 true in
\hsize=22pc
\vsize=39pc
\voffset=4.5pc

\setspinemargin{4.5pc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Output Routine
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifclearedpage
\newif\ifdisplaypage

% Write one page (textblock, headline, and footline).
\def\facingpages{%
  \ifclearedpage\headline={\line{}}\footline={\line{}}\fi%
  \ifdisplaypage\headline={\line{}}\footline={\displaypagefootline}\fi%
  \global\clearedpagefalse%
  \global\displaypagefalse%
  \dimen0=\ifodd\pageno\textblock@odd@left\else\textblock@even@left\fi%
  \shipout\vbox{\moveright\dimen0\vbox{\makeheadline\pagebody\makefootline}}%
  \advancepageno%
  \ifnum\outputpenalty>-20000 \else\dosupereject\fi%
}
\output{\facingpages}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Page Frame (Headline and Footline)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\useemptyframethispage{\clearedpagetrue\displaypagefalse}
\def\usedisplayframethispage{\displaypagetrue\clearedpagefalse}

\def\useemptypageframes{
  \global\headline={\line{}}
  \global\footline={\line{}}
  \global\clearedpagefalse
  \global\displaypagefalse
}

\def\usenormalpageframes{
  \global\headline={\runningheaderfont\normalpageheadline}
  \global\footline={\runningheaderfont\normalpagefootline}
  \global\clearedpagefalse
  \global\displaypagefalse
}

\def\displaypagefootline{\runningheaderfont\hfil\folio\hfil}
\def\normalpageheadline{\ifodd\pageno\normaloddpageheadline\else\normalevenpageheadline\fi}
\def\normalpagefootline{\line{}}
\def\normaloddpageheadline{\title\hfil\folio}
\def\normalevenpageheadline{\folio\hfil\author}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Pages
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\nextpage{\vfil\eject\global\clearedpagetrue\global\displaypagefalse\relax}
\def\nextoddpage{\nextpage\ifodd\pageno \else \line{}\nextpage\fi}
\def\nextevenpage{\nextpage\ifodd\pageno \line{}\nextpage\else \fi}

\raggedbottom

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Divisions
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\frontmatter{\nextoddpage\pageno=-1\useemptypageframes}
\def\mainmatter{\nextoddpage\pageno=1\usenormalpageframes}
\def\backmatter{\frontmatter}

\def\part#1{
  \nextoddpage
  \useemptyframethispage
  \baselinebox{\raggedleft\parttitle#1\par}{10}{0}
  \nextoddpage
}

\def\chapter#1{
  \nextpage
  \usedisplayframethispage
  \baselinebox{{\ifodd\pageno\raggedleft\else\raggedright\fi\chaptertitle#1\par}}{10}{1}
}

% \bookinfo is a named frontmatter or backmatter division.
\def\bookinfo#1{
  \nextpage
  \useemptypageframes
  {\centered\chaptertitle{#1}\par}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Titles
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \baselinebox{content}{bottom (baselines)}{skip (baselines)}
\long\def\baselinebox#1#2#3{\vbox to #2\leading{\line{}\vfill#1}\vskip#3\leading}

\def\booktitle#1{\booktitlefont\titleleading\uppercase\expandafter{#1}}
\def\authorname#1{\authornamefont\titleleading\uppercase\expandafter{#1}}
\def\parttitle#1{\parttitlefont\titleleading#1}
\def\chaptertitle#1{\chaptertitlefont\titleleading#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Logo
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\font\logofont=ProximaNova-Regular-lf-titling-ly1 at \cheadsize

\newdimen\logobarthickness
\logobarthickness=\fontdimen6\logofont
\divide\logobarthickness by 16
\def\logolineskip{\vskip4\logobarthickness}

% \stackedlogo{left glue}{right glue}
\def\stackedlogo#1#2{%
  \begingroup%
  \offinterlineskip%
  \logofont%
  \setbox0=\hbox{DRISCOLL}%
  \vbox{%
    \hrule height \logobarthickness%
    \logolineskip%
    \copy0%
    \logolineskip%
    \hbox to \wd0{#1BROOK#2}%
    \logolineskip%
    \hbox to \wd0{#1PRESS#2}%
    \logolineskip%
    \hrule height \logobarthickness%
  }%
  \endgroup%
}

\def\leftlogo{\stackedlogo{}{\hss}}
\def\centerlogo{\stackedlogo{\hss}{\hss}}
\def\rightlogo{\stackedlogo{\hss}{}}

% \linelogo{font size}
\def\linelogo{%
  \begingroup%
  \offinterlineskip%
  \logofont%
  \vbox{%
    \hrule height \logobarthickness%
    \logolineskip%
    \hbox{DRISCOLL BROOK PRESS}%
    \logolineskip%
    \hrule height \logobarthickness%
  }%
  \endgroup%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Paragraph Styles
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\raggedleft{\parindent=0pt\parfillskip=0pt\leftskip=0pt plus \hsize\relax}
\def\raggedright{\parindent=0pt\parfillskip=0pt\rightskip=0pt plus \hsize\relax}
\def\centered{\raggedleft\raggedright}
\newdimen\leading \leading=15pt

\def\authorinfoheading#1{\bigskip\bigskip{\sc\centered#1\par}}
\def\authorinfoitem#1{\medskip{\centered#1\par}}
\def\connect#1#2{\authorinfoheading{#1}\authorinfoitem{#2}}
\def\genre#1{\authorinfoheading{#1}}
\def\genrebook#1{\authorinfoitem{#1}}

\def\titleleading{\linespacing{1.1}}

\def\linespacing#1{\baselineskip=#1\fontdimen6\the\font}

% TODO Create macros to set these parameters up.
\parindent=1em
\normalbaselineskip=\leading
\normalbaselines
\emergencystretch=1.5em

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Character Styles
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% TODO: Make this handle nested emphasis.
%       Or give a way to go back to roman.
%       Or switch to {\rm ...} and {\it ...}.
\def\emph#1{{\it #1}}
\def\leadin#1{\nobreak\noindent{\sc #1}}

\chardef\copyright=169

\rm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Microtypography
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pdffontexpand\rm 30 30 10 autoexpand
\pdfadjustspacing=2
\pdfprotrudechars=2

\catcode`\@=12
